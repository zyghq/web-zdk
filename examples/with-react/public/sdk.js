(()=>{var I=window.ZygEnv||"production",s=I==="development"?console.log.bind(console):()=>{};function S(d,a){try{return typeof window<"u"&&window.localStorage?(localStorage.setItem(d,a),!0):!1}catch(c){return console.error("Error setting localStorage:",c),!1}}function f(d){try{return typeof window<"u"&&window.localStorage?localStorage.getItem(d):null}catch(a){return console.error("Error getting localStorage:",a),null}}function p(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){let a=Math.random()*16|0;return(d==="x"?a:a&3|8).toString(16)})}(function(){var d,a=!0,c=window.innerWidth;let g="http://localhost:3000";function y(t){s("TODO:fetch widget config!",t);let e={allowOnlyDomains:!1,domainsOnly:!1,domains:null,bubblePosition:"right",headerColor:"#9370DB",profilePicture:null,iconColor:"#ffff"};return Promise.resolve(e)}function h(){var t=document.getElementById("zyg-frame");t.style.opacity="0",t.style.transform="scale(0)",t.style.position="fixed",document.getElementById("zyg-button").style.display="block",a=!0}function x(){var t=document.getElementById("zyg-frame");t.style.opacity="1",t.style.transform="scale(1)",t.style.position="fixed",c<768&&(document.getElementById("zyg-button").style.display="none"),a=!1}function w(t){s("on handleIfcReady...");let e=f(t),o=document.getElementById("zyg-iframe"),n={type:"customer",data:e};return o.contentWindow.postMessage(JSON.stringify(n),g),!0}function b(t){s("handleIfcAck",t);let e=document.getElementById("zyg-iframe"),o={type:"start"};return e.contentWindow.postMessage(JSON.stringify(o),g),!0}function v(){c=window.innerWidth;var t=document.getElementById("zyg-frame"),e=c>768?"width: 448px; height: 72vh; max-height: 720px;":"width: 100%; height: 100%; max-height: 100%; min-height: 100%; left: 0px; right: 0px; bottom: 0px; top: 0px;",o=d.bubblePosition==="right"?"right: 16px; left: unset; transform-origin: right bottom;":"left: 16px; right: unset; transform-origin: left bottom;",n=a?"opacity: 0 !important; transform: scale(0) !important;":"opacity: 1 !important; transform: scale(1) !important;";t.style.cssText="box-shadow: rgba(150, 150, 150, 0.2) 0px 10px 30px 0px, rgba(150, 150, 150, 0.2) 0px 0px 0px 1px; overflow: hidden !important; border: none !important; display: block !important; z-index: 2147483645 !important; border-radius: 0.75rem; bottom: 96px; transition: scale 200ms ease-out 0ms, opacity 200ms ease-out 0ms; position: fixed !important;"+o+e+n}function E(t){if(t.domainsOnly&&t.domains){let i=t.domains,r=window.location.hostname;if(!i.includes(r)){console.log("domain not allowed...");return}}var e=document.createElement("div");e.setAttribute("id","zyg-frame");var o=c>768?"width: 448px; height: 72vh; max-height: 720px":"width: 100%; height: 100%; max-height: 100%; min-height: 100%; left: 0px; right: 0px; bottom: 0px; top: 0px;",n=t.bubblePosition&&t.bubblePosition==="right"?"right: 16px; left: unset; transform-origin: right bottom;":"left: 16px; right: unset; transform-origin: left bottom;";e.style.cssText="position: fixed !important; box-shadow: rgba(150, 150, 150, 0.2) 0px 10px 30px 0px, rgba(150, 150, 150, 0.2) 0px 0px 0px 1px; overflow: hidden !important; opacity: 0 !important; border: none !important; display: none !important; z-index: 2147483645 !important; border-radius: 0.75rem; bottom: 96px; transition: scale 200ms ease-out 0ms, opacity 200ms ease-out 0ms; transform: scale(0) !important;"+n+o;var l=document.createElement("iframe");l.setAttribute("id","zyg-iframe"),l.setAttribute("title","Zyg Widget"),l.setAttribute("src",g),l.setAttribute("frameborder","0"),l.setAttribute("scrolling","no"),l.setAttribute("style","border: 0px !important; width: 100% !important; height: 100% !important; display: block !important; opacity: 1 !important;"),e.appendChild(l),document.body.appendChild(e),l.addEventListener("load",function(){s("iframe on load...");var i=document.createElement("div");i.setAttribute("id","zyg-button");var r="background-color:"+t.headerColor+";";r+="position: fixed; bottom: 1rem;",r+=t.bubblePosition&&t.bubblePosition==="right"?"right: 16px; left: unset;":"left: 16px; right: unset;",r+="width: 50px; height: 50px; border-radius: 25px; 0px 4px 8px 0px; cursor: pointer; z-index: 2147483645;",r+="transition: transform 0.2s ease-in-out, opacity 0.2s ease-in-out; transform: scale(0); opacity: 0;",i.style.cssText=r;var u='<div style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; z-index: 2147483646;">';t.profilePicture?u+='<img src="'+t.profilePicture+'" style="width: 100%; height: 100%; border-radius: 100px;" />':u+=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="${t.iconColor}" style="width: 60%; height: 60%;"><path fill-rule="evenodd" d="M4.848 2.771A49.144 49.144 0 0112 2.25c2.43 0 4.817.178 7.152.52 1.978.292 3.348 2.024 3.348 3.97v6.02c0 1.946-1.37 3.678-3.348 3.97a48.901 48.901 0 01-3.476.383.39.39 0 00-.297.17l-2.755 4.133a.75.75 0 01-1.248 0l-2.755-4.133a.39.39 0 00-.297-.17 48.9 48.9 0 01-3.476-.384c-1.978-.29-3.348-2.024-3.348-3.97V6.741c0-1.946 1.37-3.68 3.348-3.97zM6.75 8.25a.75.75 0 01.75-.75h9a.75.75 0 010 1.5h-9a.75.75 0 01-.75-.75zm.75 2.25a.75.75 0 000 1.5H12a.75.75 0 000-1.5H7.5z" clip-rule="evenodd" /></svg>`,u+="</div>",i.innerHTML=u,document.body.appendChild(i),setTimeout(function(){i.style.opacity="1",i.style.transform="scale(1)",e.style.display="block"},1e3),i.addEventListener("click",function(){a?x():h()})})}let m=function(){let t=function(...e){t.push(...e)};return t.booted=!1,t.widgetId=null,t.customerExternalId=null,t.customerEmail=null,t.customerPhone=null,t.customerHash=null,t._eventTarget=new EventTarget,t._triggerEvent=function(e,o){let n=new CustomEvent(e,{detail:o});this._eventTarget.dispatchEvent(n)},t.onMessageHandler=function(e){s("evt origin:",e.origin),s("evt source",e.source),s("evt data",e.data),e.origin===g&&(e.data==="close"&&h(),e.data==="ifc:error"&&s("iframe error!"),e.data==="ifc:ready"&&w(t.widgetId),e.data==="ifc:ack"&&b(t.widgetId))},t.q=[],t.processQueue=function(){for(;t.q.length>0;){let e=t.q.shift();e&&t.executeCommand.apply(t,e)}},t.executeCommand=function(...e){let o=e[0],n=e.slice(1);switch(o){case"init":s("init invoked with args:",n),t.init(n[0]);break;default:throw new Error(`Unknown command: ${o}`)}},t.push=function(...e){typeof e[0]=="function"?e[0]():(t.q.push(e),t.processQueue())},t.on=function(e,o){t._eventTarget.addEventListener(e,o)},t.off=function(e,o){t._eventTarget.removeEventListener(e,o)},t.processQueue(),t.init=function(e){if(typeof e!="object"||!e.widgetId)throw new Error("Invalid configuration. widgetId is required.");this.widgetId=e.widgetId,this.customerExternalId=e.customerExternalId||null,this.customerEmail=e.customerEmail||null,this.customerPhone=e.customerPhone||null,this.customerHash=e.customerHash||null,this.traits=e.traits||null;let o=!!this.customerExternalId||!!this.customerEmail||!!this.customerPhone;if(o&&!this.customerHash)throw new Error("Invalid configuration. customerHash is required when customerExternalId, customerEmail, customerPhone are provided.");if(!o&&this.customerHash)throw new Error("Invalid configuration. customerHash is required when customerExternalId, customerEmail, customerPhone are not provided.");y(this.widgetId).then(n=>{s("fetched widget config",n),d=n}).then(()=>{s("configure widget store...");let n={widgetId:this.widgetId};if(this.customerExternalId?n.customerExternalId=this.customerExternalId:this.customerEmail?n.customerEmail=this.customerEmail:this.customerPhone&&(n.customerPhone=this.customerPhone),this.customerHash)n.customerHash=this.customerHash;else{let i=f(this.widgetId);if(i)try{let r=JSON.parse(i);r.anonId&&(n.anonId=r.anonId)}catch(r){console.error("Error parsing existing storage",r),n.anonId=p()}else n.anonId=p()}if(this.traits&&(n.traits=this.traits),!S(this.widgetId,JSON.stringify(n)))throw new Error("Error storing widget store in localStorage.")}).then(()=>{s("create iframe widget..."),E(d),window.addEventListener("message",this.onMessageHandler),window.addEventListener("resize",v)}).catch(n=>{console.error("Error fetching widget config",n)}),setTimeout(()=>{this._triggerEvent("ready"),this.booted=!0,setTimeout(()=>{this._triggerEvent("authenticated")},500)},1e3)},t}();if(window.ZygSDK.q)for(let t=0;t<window.ZygSDK.q.length;t++)m.push.apply(m,window.ZygSDK.q[t]);window.ZygSDK=m,window.dispatchEvent(new Event("zygsdk:loaded"))})();})();
//# sourceMappingURL=sdk.js.map
